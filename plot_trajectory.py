import pandas as pd
import matplotlib.pyplot as plt
import os

# Path to the log file generated by temporal_shell_tracking.py
LOG_PATH = "pipeline_rgb/shape/model_stage2/temporal_shell_log.csv"
OUTPUT_IMG = "trajectory_stability.png"

def plot_trajectory():
    if not os.path.exists(LOG_PATH):
        print(f"Error: Could not find {LOG_PATH}. Run temporal_shell_tracking.py first.")
        return

    # Load Data
    df = pd.read_csv(LOG_PATH)
    
    # Extract Centroids
    x = df["centroid_x"]
    y = df["centroid_y"]
    frames = df["frame"]

    plt.figure(figsize=(10, 6))
    
    # Plot Path
    plt.plot(x, y, label="Robot Centroid Path", color="blue", linewidth=2, marker='o', markersize=3, alpha=0.6)
    
    # Highlight Start and End
    plt.scatter(x.iloc[0], y.iloc[0], color="green", s=100, label="Start", zorder=5)
    plt.scatter(x.iloc[-1], y.iloc[-1], color="red", s=100, label="End", zorder=5)

    plt.title("Temporal Tracking Stability (Centroid Path)", fontsize=14, fontweight='bold')
    plt.xlabel("Global X Position (m)")
    plt.ylabel("Global Y Position (m)")
    plt.legend()
    plt.grid(True, linestyle='--', alpha=0.5)
    
    plt.tight_layout()
    plt.savefig(OUTPUT_IMG, dpi=300)
    print(f"Trajectory plot saved to {OUTPUT_IMG}")
    plt.close()

if __name__ == "__main__":
    plot_trajectory()